<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© ØºØ§Ø¯Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØµÙˆÙ„ ÙˆØ§Ù„ØªØ­Ø¯ÙŠ</title>
    <style>
        :root { --primary: #1a2a6c; --gold: #d4af37; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .app-container { width: 100%; max-width: 900px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin: auto; border: 2px solid var(--primary); }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; border-bottom: 4px solid var(--gold); }
        .screen { padding: 20px; display: none; text-align: center; }
        .active { display: block; }
        
        .setup-box { background: #fff; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #ddd; }
        textarea { width: 100%; height: 100px; border-radius: 10px; padding: 10px; border: 1px solid #ccc; margin: 10px 0; resize: none; }
        select, input[type="text"] { padding: 10px; border-radius: 5px; border: 1px solid #ccc; margin: 5px; font-size: 1rem; }

        .groups-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .group-card { background: #fefefe; padding: 15px; border-radius: 10px; border: 1px solid #eee; border-top: 4px solid var(--gold); }
        
        .riddle-card { background: #fff; border-right: 10px solid var(--gold); padding: 30px; border-radius: 15px; font-size: 1.6rem; color: var(--primary); margin: 25px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        .btn { padding: 12px 25px; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; transition: 0.3s; margin: 5px; }
        .btn-gold { background: var(--gold); color: white; width: 100%; max-width: 250px; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-correct { background: #27ae60; color: white; flex: 1; }
        .btn-wrong { background: #e74c3c; color: white; flex: 1; }

        .score-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .score-table th, .score-table td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .score-table th { background: var(--primary); color: white; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h2>Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© ØºØ§Ø¯Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ</h2>
        <div id="project-subtitle">Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠ Ø§Ù„Ù…ØªØ±Ø§Ø¯ÙØ§Øª ÙˆØ§Ù„Ø£Ø¶Ø¯Ø§Ø¯</div>
    </div>

    <div id="setup-screen" class="screen active">
        <div class="setup-box">
            <h3>Ø¥Ø¶Ø§ÙØ© ÙØµÙ„ Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="className" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØµÙ„ (Ù…Ø«Ù„Ø§Ù‹: Ø£ÙˆÙ„/1)">
            <textarea id="classNamesList" placeholder="Ø§Ù„ØµÙ‚ Ø£Ø³Ù…Ø§Ø¡ Ø·Ù„Ø§Ø¨ Ø§Ù„ÙØµÙ„ Ù‡Ù†Ø§ (Ø§Ø³Ù… ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±)..."></textarea>
            <button class="btn btn-blue" onclick="addClass()">Ø­ÙØ¸ Ø§Ù„ÙØµÙ„ ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
        </div>

        <div id="fount-classes" style="margin-top: 20px;">
            <h3>Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
            <div id="classesList"></div>
        </div>
        
        <br>
        <button id="startChallengeBtn" class="btn btn-gold" style="display:none;" onclick="showGameSetup()">Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ø¯ÙŠ ğŸ</button>
    </div>

    <div id="game-setup-screen" class="screen">
        <h3>Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</h3>
        <select id="classSelector" onchange="previewGroups()"></select>
        <div class="groups-grid" id="groupsPreview"></div>
        <button class="btn btn-gold" onclick="launchGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù†</button>
        <button class="btn btn-blue" onclick="showScreen('setup-screen')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="game-screen" class="screen">
        <div style="background:var(--primary); color:white; padding:10px; border-radius:10px; margin-bottom:15px;">
            Ø§Ù„ÙØµÙ„: <span id="activeClassName"></span> | 
            <span id="activeGroupName" style="color:var(--gold)"></span>
        </div>
        <div style="font-size: 1.3rem;">Ø¯ÙˆØ± Ø§Ù„Ø·Ø§Ù„Ø¨: <b id="turnDisplay" style="color:var(--primary)">--</b></div>
        
        <div class="riddle-card" id="riddleText">...</div>
        
        <button class="btn btn-gold" id="revealBtn" onclick="revealAnswer()">ÙƒØ´Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© âœ…</button>
        
        <div id="answerDetails" style="display:none;">
            <div style="font-size: 1.4rem; color: #27ae60; margin: 15px 0;">Ø£Ù†Ø§: <b id="correctWord"></b></div>
            <div id="synAntDisplay" style="margin-bottom: 25px; background:#f9f9f9; padding:10px; border-radius:10px;"></div>
            
            <div style="display:flex; gap:10px;">
                <button class="btn btn-correct" onclick="recordScore(true)">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…</button>
                <button class="btn btn-wrong" onclick="recordScore(false)">Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© âŒ</button>
            </div>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h3 id="winningClassHeader">Ù†ØªØ§Ø¦Ø¬ ÙØµÙ„ --</h3>
        <table class="score-table">
            <thead><tr><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr></thead>
            <tbody id="scoreBody"></tbody>
        </table>
        <br>
        <button class="btn btn-gold" onclick="showScreen('game-setup-screen')">ØªØ­Ø¯ÙŠ ÙØµÙ„ Ø¢Ø®Ø± ğŸ”„</button>
    </div>
</div>

<script>
    let allData = JSON.parse(localStorage.getItem('ghada_project')) || {};
    let activeClass = "";
    let activeStudents = [];
    let currentRiddleIndex = 0;
    let currentPlayerIndex = 0;

    const riddles = [
        { q: "Ø£Ù†Ø§ Ø¨ÙŠØª Ø§Ù„Ø£Ø³Ø¯ Ø§Ù„Ù‚ÙˆÙŠ.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ø¹Ø±ÙŠÙ†", s: "Ù…Ø£ÙˆÙ‰ / Ù…Ø³ÙƒÙ†", ant: "Ø®Ù„Ø§Ø¡" },
        { q: "Ø£Ù†Ø§ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø¹Ø·Ø§Ø¡ Ø¨Ù„Ø§ Ø­Ø¯ÙˆØ¯.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "ÙƒØ±ÙŠÙ…", s: "Ø³Ø®ÙŠ / Ø¬ÙˆØ§Ø¯", ant: "Ø¨Ø®ÙŠÙ„" },
        { q: "Ø£Ù†Ø§ ÙˆÙ‚Øª Ø§Ù„Ø¸Ù„Ù…Ø© ÙˆØ³ÙƒÙˆÙ† Ø§Ù„Ù†Ø§Ø³.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ø§Ù„Ù„ÙŠÙ„", s: "Ø§Ù„Ø¹ØªÙ…Ø© / Ø§Ù„Ø¸Ù„Ø§Ù…", ant: "Ø§Ù„Ù†Ù‡Ø§Ø±" },
        { q: "Ø£Ù†Ø§ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙˆØ§Ù„Ø³Ù…Ùˆ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù†Ø©.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ø¹Ù„Ùˆ", s: "Ø±ÙØ¹Ø© / Ø³Ù…Ùˆ", ant: "Ø§Ù†Ø®ÙØ§Ø¶" },
        { q: "Ø£Ù†Ø§ Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø°ÙŠ ÙŠØ·Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ù„.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ù†ÙˆØ±", s: "Ø¶ÙŠØ§Ø¡ / Ø¥Ø´Ø±Ø§Ù‚", ant: "Ø¸Ù„Ø§Ù… / Ø¬Ù‡Ù„" },
        { q: "Ø£Ù†Ø§ Ø§Ù„Ø³Ø±Ø¹Ø© ÙÙŠ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ø¹Ø¬Ù„Ø©", s: "Ø¥Ø³Ø±Ø§Ø¹ / Ø®ÙØ©", ant: "ØªØ£Ù†ÙŠ / Ø¨Ø·Ø¡" },
        { q: "Ø£Ù†Ø§ Ø§Ù„ØµØ¯Ù‚ ÙˆØ­ÙØ¸ Ø§Ù„Ø£Ø³Ø±Ø§Ø±.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ø£Ù…Ø§Ù†Ø©", s: "ÙˆÙØ§Ø¡ / Ù†Ø²Ø§Ù‡Ø©", ant: "Ø®ÙŠØ§Ù†Ø©" },
        { q: "Ø£Ù†Ø§ ØµÙˆØª Ø§Ù„Ø±Ø¹Ø¯ Ø§Ù„Ù‚ÙˆÙŠ.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ù‡Ø²ÙŠÙ…", s: "Ù‚ØµÙ / Ø¯ÙˆÙŠ", ant: "Ù‡Ù…Ø³" },
        { q: "Ø£Ù†Ø§ Ø§Ù„ØµÙ…ÙˆØ¯ ÙÙŠ ÙˆØ¬Ù‡ Ø§Ù„Ù…ØµØ§Ø¹Ø¨.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "ØµØ¨Ø±", s: "ØªØ­Ù…Ù„ / Ø¬Ù„Ø¯", ant: "Ø¬Ø²Ø¹" },
        { q: "Ø£Ù†Ø§ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„ÙˆØ§Ø³Ø¹ Ø¬Ø¯Ø§Ù‹.. ÙÙ…Ù† Ø£Ù†Ø§ØŸ", a: "Ø®Ø¶Ù…", s: "ÙŠÙ… / Ø¨Ø­Ø±", ant: "Ø¨Ø± / ÙŠØ§Ø¨Ø³" }
        // ... Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ù„Ù„ØªØ¬Ø±Ø¨Ø©
    ];
    while(riddles.length < 100) riddles.push({...riddles[Math.floor(Math.random()*10)], q: "Ù„ØºØ² Ø¥Ø¶Ø§ÙÙŠ Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù…Ù‡Ø§Ø±Ø© #" + riddles.length});

    function addClass() {
        const name = document.getElementById('className').value.trim();
        const namesList = document.getElementById('classNamesList').value.split('\n').filter(n => n.trim() !== "");
        
        if(!name || namesList.length < 3) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙØµÙ„ Ùˆ3 Ø£Ø³Ù…Ø§Ø¡ Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
        
        const students = namesList.map((s, i) => {
            let group = "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰";
            if (i >= Math.ceil(2 * namesList.length / 3)) group = "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©";
            else if (i >= Math.ceil(namesList.length / 3)) group = "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©";
            return { name: s.trim(), score: 0, group: group };
        });

        allData[name] = students;
        localStorage.setItem('ghada_project', JSON.stringify(allData));
        document.getElementById('className').value = "";
        document.getElementById('classNamesList').value = "";
        renderClasses();
    }

    function renderClasses() {
        const list = document.getElementById('classesList');
        list.innerHTML = "";
        const keys = Object.keys(allData);
        keys.forEach(k => {
            list.innerHTML += `<button class="btn btn-blue" onclick="deleteClass('${k}')">Ø­Ø°Ù ${k} ğŸ—‘ï¸</button> `;
        });
        document.getElementById('startChallengeBtn').style.display = keys.length ? 'inline-block' : 'none';
    }

    function deleteClass(name) {
        if(confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙØµÙ„ ${name}ØŸ`)) {
            delete allData[name];
            localStorage.setItem('ghada_project', JSON.stringify(allData));
            renderClasses();
        }
    }

    function showGameSetup() {
        showScreen('game-setup-screen');
        const selector = document.getElementById('classSelector');
        selector.innerHTML = Object.keys(allData).map(k => `<option value="${k}">${k}</option>`).join('');
        previewGroups();
    }

    function previewGroups() {
        const className = document.getElementById('classSelector').value;
        const students = allData[className];
        const container = document.getElementById('groupsPreview');
        container.innerHTML = "";
        ["Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©"].forEach(g => {
            const list = students.filter(s => s.group === g).map(s => s.name).join('ØŒ ');
            container.innerHTML += `<div class="group-card"><b>${g}</b><br><small>${list || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</small></div>`;
        });
    }

    function launchGame() {
        activeClass = document.getElementById('classSelector').value;
        activeStudents = JSON.parse(JSON.stringify(allData[activeClass])); // Ù†Ø³Ø®Ø© Ù„Ù„Ø¹Ø¨
        currentRiddleIndex = 0;
        currentPlayerIndex = 0;
        showScreen('game-screen');
        document.getElementById('activeClassName').innerText = activeClass;
        nextTurn();
    }

    function nextTurn() {
        if(currentRiddleIndex >= riddles.length) return showResults();
        const s = activeStudents[currentPlayerIndex];
        document.getElementById('activeGroupName').innerText = s.group;
        document.getElementById('turnDisplay').innerText = s.name;
        document.getElementById('riddleText').innerText = riddles[currentRiddleIndex].q;
        document.getElementById('answerDetails').style.display = 'none';
        document.getElementById('revealBtn').style.display = 'block';
    }

    function revealAnswer() {
        const r = riddles[currentRiddleIndex];
        document.getElementById('correctWord').innerText = r.a;
        document.getElementById('synAntDisplay').innerHTML = `<b>Ø§Ù„Ù…ØªØ±Ø§Ø¯Ù:</b> ${r.s} <br> <b>Ø§Ù„Ø¶Ø¯:</b> ${r.ant}`;
        document.getElementById('answerDetails').style.display = 'block';
        document.getElementById('revealBtn').style.display = 'none';
    }

    function recordScore(isCorrect) {
        if(isCorrect) activeStudents[currentPlayerIndex].score += 1;
        currentRiddleIndex++;
        currentPlayerIndex = (currentPlayerIndex + 1) % activeStudents.length;
        nextTurn();
    }

    function showResults() {
        showScreen('result-screen');
        document.getElementById('winningClassHeader').innerText = `Ù†ØªØ§Ø¦Ø¬ ÙØµÙ„: ${activeClass}`;
        const body = document.getElementById('scoreBody');
        activeStudents.sort((a,b) => b.score - a.score);
        body.innerHTML = activeStudents.map(s => `<tr><td>${s.group}</td><td>${s.name}</td><td>${s.score}</td></tr>`).join('');
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    window.onload = renderClasses;
</script>

</body>
</html>
